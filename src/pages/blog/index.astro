---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import PostCard from '../../components/PostCard.astro';

const basePath = Astro.site ? new URL(Astro.site).pathname.replace(/\/$/, '') : '';

const posts = await Astro.glob('./*.md');
posts.sort((a,b)=> new Date(b.frontmatter.pubDate||0).getTime() - new Date(a.frontmatter.pubDate||0).getTime());

// Chuẩn bị tag cloud
const tagSet = new Set<string>();
for (const p of posts) (p.frontmatter.tags || []).forEach((t: string) => tagSet.add(t));
const tags = Array.from(tagSet).sort((a,b)=> a.localeCompare(b, 'vi'));
---
<BaseLayout title="Blog • Lê Nguyễn Duy Khang" description="Blog chia sẻ kiến thức Java, JavaScript, lập trình mạng máy tính: OOP, DOM, Fetch API, Socket, REST API...">
  <Nav />
  <main class="container section">

    <section class="page-hero card" style="padding:18px">
      <h1 class="page-title">Blog</h1>
      <p class="page-subtitle">Nhật ký học tập và chia sẻ thực hành: Java • JavaScript • Lập trình mạng</p>

      {tags.length > 0 && (
        <div class="tag-cloud">
          {tags.map((t) => (
            <a class="tag-chip" href={`${basePath}/tags/${t.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-').replace(/-+/g,'-')}`}>
              {t}
            </a>
          ))}
        </div>
      )}
    </section>

    <div class="grid" style="margin-top:16px">
      {posts.map((p) => (
        <PostCard
          url={p.url}
          title={p.frontmatter.title}
          description={p.frontmatter.description}
          pubDate={p.frontmatter.pubDate}
          tags={p.frontmatter.tags}
        />
      ))}
    </div>
  </main>
  <Footer />
</BaseLayout>
