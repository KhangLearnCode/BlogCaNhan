---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

const basePath = Astro.site ? new URL(Astro.site).pathname.replace(/\/$/, '') : '';

// KHU Vá»°C CHá»¨NG CHá»ˆ (giá»¯ nhÆ° cÅ©, cáº­p nháº­t link/Ä‘Æ°á»ng dáº«n cá»§a báº¡n)
const certificates = [
  {
    title: 'Networking Basics',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/networking-basics.jpg',
    pdf: 'certificates/networking-basics.pdf',
    credly: 'https://www.credly.com/earner/<your-credly>/badge/<badge-id>',
  },
  {
    title: 'JavaScript Essentials 1',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/javascript-essentials-1.jpg',
    pdf: 'certificates/javascript-essentials-1.pdf',
    credly: 'https://www.credly.com/earner/<your-credly>/badge/<badge-id>',
  },
  {
    title: 'JavaScript Essentials 2',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/javascript-essentials-2.jpg',
    pdf: 'certificates/javascript-essentials-2.pdf',
    credly: 'https://www.credly.com/earner/<your-credly>/badge/<badge-id>',
  },
];
---
<BaseLayout title="ThÃ nh tÃ­ch â€¢ LÃª Nguyá»…n Duy Khang" description="CÃ¡c dá»± Ã¡n mÃ£ nguá»“n má»Ÿ vÃ  chá»©ng chá»‰ tiÃªu biá»ƒu.">
  <Nav />
  <main class="container section">
    <h1>ThÃ nh tÃ­ch</h1>

    <!-- Má»¤C Dá»° ÃN -->
    <section style="margin: 12px 0 26px">
      <h2 style="margin:.2rem 0 8px">Dá»± Ã¡n</h2>
      <p style="color:var(--muted); margin:0 0 12px">
        Má»™t sá»‘ dá»± Ã¡n mÃ£ nguá»“n má»Ÿ mÃ¬nh cÃ´ng khai trÃªn GitHub, táº­p trung vÃ o Java, JavaScript vÃ  láº­p trÃ¬nh máº¡ng.
        Danh sÃ¡ch dÆ°á»›i Ä‘Ã¢y Ä‘Æ°á»£c cáº­p nháº­t tá»± Ä‘á»™ng vÃ  Æ°u tiÃªn nhá»¯ng repo cÃ³ nhiá»u sao hoáº·c Ä‘Æ°á»£c cáº­p nháº­t gáº§n Ä‘Ã¢y.
      </p>

      <div id="repo-grid" class="grid">
        <!-- Skeleton khi Ä‘ang táº£i -->
        {Array.from({ length: 6 }).map(() => (
          <div class="card repo-card skeleton">
            <div class="sk-row sk-title"></div>
            <div class="sk-row sk-text"></div>
            <div class="sk-row sk-text short"></div>
            <div class="sk-tags">
              <span class="sk-chip"></span>
              <span class="sk-chip"></span>
              <span class="sk-chip"></span>
            </div>
          </div>
        ))}
      </div>

      <script is:inline>
        (async () => {
          const username = 'KhangLearnCode';
          const grid = document.getElementById('repo-grid');
          try {
            const resp = await fetch(`https://api.github.com/users/${username}/repos?per_page=100&sort=updated`);
            if (!resp.ok) throw new Error('GitHub API error ' + resp.status);
            const raw = await resp.json();
            const repos = (Array.isArray(raw) ? raw : [])
              .filter(r => !r.fork && !r.archived)
              .map(r => ({
                name: r.name,
                html_url: r.html_url,
                description: r.description || '',
                language: r.language || '',
                stars: r.stargazers_count || 0,
                updated: r.pushed_at || r.updated_at || r.created_at,
                topics: r.topics || [],
              }))
              .sort((a, b) => {
                if (b.stars !== a.stars) return b.stars - a.stars;
                return new Date(b.updated) - new Date(a.updated);
              });

            const top = repos.slice(0, 12);
            if (!top.length) {
              grid.innerHTML = '<div class="card"><p style="color:var(--muted)">ChÆ°a cÃ³ dá»± Ã¡n cÃ´ng khai nÃ o hoáº·c API giá»›i háº¡n táº¡m thá»i. Vui lÃ²ng thá»­ láº¡i sau.</p></div>';
              return;
            }

            const iconStar = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="m12 2 2.6 5.3 5.9.9-4.3 4.2 1 5.9-5.2-2.7-5.2 2.7 1-5.9L3.5 8.2l5.9-.9L12 2Z"/></svg>';
            const iconLang = '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="6"/></svg>';
            const fmtDate = (s) => new Date(s).toLocaleDateString('vi-VN');

            grid.innerHTML = top.map(r => `
              <div class="card repo-card">
                <h3 style="margin:.1rem 0 .3rem">
                  <a class="title-link" href="${r.html_url}" target="_blank" rel="noreferrer">${r.name}</a>
                </h3>
                ${r.description ? `<p class="repo-desc">${r.description}</p>` : ''}
                <div class="repo-meta">
                  <span title="NgÃ´n ngá»¯">${iconLang} ${r.language || 'â€”'}</span>
                  <span title="Sá»‘ sao">${iconStar} ${r.stars}</span>
                  <span title="Cáº­p nháº­t">${fmtDate(r.updated)}</span>
                </div>
                ${r.topics?.length ? `
                  <div class="repo-topics">
                    ${r.topics.slice(0,6).map(t => `<span class="topic">${t}</span>`).join('')}
                  </div>
                ` : ''}
              </div>
            `).join('');
          } catch (e) {
            console.error(e);
            grid.innerHTML = '<div class="card"><p style="color:var(--muted)">KhÃ´ng thá»ƒ táº£i danh sÃ¡ch dá»± Ã¡n tá»« GitHub ngay lÃºc nÃ y.</p></div>';
          }
        })();
      </script>
    </section>

    <!-- Má»¤C CHá»¨NG CHá»ˆ -->
    <section style="margin: 22px 0 0">
      <h2 style="margin:.2rem 0 12px">Chá»©ng chá»‰</h2>
      <p style="color:var(--muted); margin: 0 0 12px">
        áº¢nh dÆ°á»›i Ä‘Ã¢y lÃ  thumbnail (xuáº¥t tá»« PDF). Báº¡n cÃ³ thá»ƒ báº¥m â€œXem PDFâ€ Ä‘á»ƒ má»Ÿ chá»©ng chá»‰ Ä‘áº§y Ä‘á»§ hoáº·c â€œXem trÃªn Credlyâ€.
      </p>
      <div class="grid">
        {certificates.map((c) => (
          <div class="card" style="overflow:hidden">
            <img
              src={`${basePath}/${c.img}`}
              alt={`Chá»©ng chá»‰ ${c.title} â€“ ${c.issuer}`}
              style="width:100%; aspect-ratio: 4 / 3; object-fit: cover; border-radius:12px; border:1px solid rgba(255,255,255,.08);"
              loading="lazy"
              decoding="async"
            />
            <div class="meta" style="margin-top:8px">{c.issuer} â€¢ {c.issued}</div>
            <h3 style="margin:.4rem 0 .4rem">{c.title}</h3>
            <div style="display:flex; gap:10px; flex-wrap:wrap">
              <a class="btn" href={`${basePath}/${c.pdf}`} target="_blank" rel="noreferrer" aria-label={`Xem PDF: ${c.title}`}>ğŸ“„ Xem PDF</a>
              <a class="btn" style="background:linear-gradient(135deg,var(--brand),var(--primary))" href={c.credly} target="_blank" rel="noreferrer" aria-label={`Xem trÃªn Credly: ${c.title}`}>ğŸ”— Xem trÃªn Credly</a>
            </div>
          </div>
        ))}
      </div>
    </section>
  </main>
  <Footer />
</BaseLayout>
