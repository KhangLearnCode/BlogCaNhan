---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

const basePath = Astro.site ? new URL(Astro.site).pathname.replace(/\/$/, '') : '';

const certificates = [
  {
    title: 'Networking Basics',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/networking-basics.jpg',
    pdf: 'certificates/networking-basics.pdf',
  },
  {
    title: 'JavaScript Essentials 1',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/javascript-essentials-1.jpg',
    pdf: 'certificates/javascript-essentials-1.pdf',
  },
  {
    title: 'JavaScript Essentials 2',
    issuer: 'Cisco Networking Academy',
    issued: '2025',
    img: 'certificates/javascript-essentials-2.jpg',
    pdf: 'certificates/javascript-essentials-2.pdf',
  },
];
---
<BaseLayout title="Th√†nh t√≠ch ‚Ä¢ L√™ Nguy·ªÖn Duy Khang" description="C√°c d·ª± √°n m√£ ngu·ªìn m·ªü v√† ch·ª©ng ch·ªâ ti√™u bi·ªÉu.">
  <Nav />
  <main class="container section">
    <h1>Th√†nh t√≠ch</h1>

    <!-- M·ª§C D·ª∞ √ÅN -->
    <section style="margin: 12px 0 26px">
      <h2 style="margin:.2rem 0 8px">D·ª± √°n</h2>
      <p style="color:var(--muted); margin:0 0 12px">
        M·ªôt s·ªë d·ª± √°n m√£ ngu·ªìn m·ªü m√¨nh c√¥ng khai tr√™n GitHub, t·∫≠p trung v√†o Java, JavaScript v√† l·∫≠p tr√¨nh m·∫°ng.
        Danh s√°ch d∆∞·ªõi ƒë√¢y ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông v√† ∆∞u ti√™n nh·ªØng repo c√≥ nhi·ªÅu sao ho·∫∑c ƒë∆∞·ª£c c·∫≠p nh·∫≠t g·∫ßn ƒë√¢y.
      </p>

      <div id="repo-grid" class="grid">
        <!-- Skeleton khi ƒëang t·∫£i -->
        {Array.from({ length: 6 }).map(() => (
          <div class="card repo-card skeleton">
            <div class="sk-row sk-title"></div>
            <div class="sk-row sk-text"></div>
            <div class="sk-row sk-text short"></div>
            <div class="sk-tags">
              <span class="sk-chip"></span>
              <span class="sk-chip"></span>
              <span class="sk-chip"></span>
            </div>
          </div>
        ))}
      </div>

      <script is:inline>
        (async () => {
          const username = 'KhangLearnCode';
          const grid = document.getElementById('repo-grid');
          try {
            const resp = await fetch(`https://api.github.com/users/${username}/repos?per_page=100&sort=updated`);
            if (!resp.ok) throw new Error('GitHub API error ' + resp.status);
            const raw = await resp.json();
            const repos = (Array.isArray(raw) ? raw : [])
              .filter(r => !r.fork && !r.archived)
              .map(r => ({
                name: r.name,
                html_url: r.html_url,
                description: r.description || '',
                language: r.language || '',
                stars: r.stargazers_count || 0,
                updated: r.pushed_at || r.updated_at || r.created_at,
                topics: r.topics || [],
              }))
              .sort((a, b) => {
                if (b.stars !== a.stars) return b.stars - a.stars;
                return new Date(b.updated) - new Date(a.updated);
              });

            const top = repos.slice(0, 12);
            if (!top.length) {
              grid.innerHTML = '<div class="card"><p style="color:var(--muted)">Ch∆∞a c√≥ d·ª± √°n c√¥ng khai n√†o ho·∫∑c API gi·ªõi h·∫°n t·∫°m th·ªùi. Vui l√≤ng th·ª≠ l·∫°i sau.</p></div>';
              return;
            }

            const iconStar = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="m12 2 2.6 5.3 5.9.9-4.3 4.2 1 5.9-5.2-2.7-5.2 2.7 1-5.9L3.5 8.2l5.9-.9L12 2Z"/></svg>';
            const iconLang = '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="6"/></svg>';
            const fmtDate = (s) => new Date(s).toLocaleDateString('vi-VN');

            grid.innerHTML = top.map(r => `
              <div class="card repo-card">
                <h3 style="margin:.1rem 0 .3rem">
                  <a class="title-link" href="${r.html_url}" target="_blank" rel="noreferrer">${r.name}</a>
                </h3>
                ${r.description ? `<p class="repo-desc">${r.description}</p>` : ''}
                <div class="repo-meta">
                  <span title="Ng√¥n ng·ªØ">${iconLang} ${r.language || '‚Äî'}</span>
                  <span title="S·ªë sao">${iconStar} ${r.stars}</span>
                  <span title="C·∫≠p nh·∫≠t">${fmtDate(r.updated)}</span>
                </div>
                ${r.topics?.length ? `
                  <div class="repo-topics">
                    ${r.topics.slice(0,6).map(t => `<span class="topic">${t}</span>`).join('')}
                  </div>
                ` : ''}
              </div>
            `).join('');
          } catch (e) {
            console.error(e);
            grid.innerHTML = '<div class="card"><p style="color:var(--muted)">Kh√¥ng th·ªÉ t·∫£i danh s√°ch d·ª± √°n t·ª´ GitHub ngay l√∫c n√†y.</p></div>';
          }
        })();
      </script>
    </section>

    <!-- M·ª§C CH·ª®NG CH·ªà -->
    <section style="margin: 22px 0 0">
      <h2 style="margin:.2rem 0 12px">Ch·ª©ng ch·ªâ</h2>
      <p style="color:var(--muted); margin: 0 0 12px">
        ·∫¢nh d∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë ch·ª©ng ch·ªâ ƒë·∫°t ƒë∆∞·ª£c, b·∫°n c√≥ th·ªÉ b·∫•m ‚ÄúXem PDF‚Äù ƒë·ªÉ m·ªü ch·ª©ng ch·ªâ ƒë·∫ßy ƒë·ªß.
      </p>
      <div class="grid">
        {certificates.map((c) => (
          <div class="card" style="overflow:hidden">
            <img
              src={`${basePath}/${c.img}`}
              alt={`Ch·ª©ng ch·ªâ ${c.title} ‚Äì ${c.issuer}`}
              style="width:100%; aspect-ratio: 4 / 3; object-fit: cover; border-radius:12px; border:1px solid rgba(255,255,255,.08);"
              loading="lazy"
              decoding="async"
            />
            <div class="meta" style="margin-top:8px">{c.issuer} ‚Ä¢ {c.issued}</div>
            <h3 style="margin:.4rem 0 .4rem">{c.title}</h3>
            <div style="display:flex; gap:10px; flex-wrap:wrap">
              <a class="btn" href={`${basePath}/${c.pdf}`} target="_blank" rel="noreferrer" aria-label={`Xem PDF: ${c.title}`}>üìÑ Xem PDF</a>
            </div>
          </div>
        ))}
      </div>
    </section>
  </main>
  <Footer />
</BaseLayout>
